<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Indexed DB API | MAD9022-W21</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Cross Platform Application Development II">
    
    <link rel="preload" href="/W2021/assets/css/0.styles.9c5fa8ba.css" as="style"><link rel="preload" href="/W2021/assets/js/app.5f620c32.js" as="script"><link rel="preload" href="/W2021/assets/js/2.58046445.js" as="script"><link rel="preload" href="/W2021/assets/js/64.95e1f72f.js" as="script"><link rel="preload" href="/W2021/assets/js/9.536c9148.js" as="script"><link rel="prefetch" href="/W2021/assets/js/10.3b8e81aa.js"><link rel="prefetch" href="/W2021/assets/js/11.da83352d.js"><link rel="prefetch" href="/W2021/assets/js/12.b7e62dfc.js"><link rel="prefetch" href="/W2021/assets/js/13.6eef42af.js"><link rel="prefetch" href="/W2021/assets/js/14.d9a3848c.js"><link rel="prefetch" href="/W2021/assets/js/15.9dbe3d80.js"><link rel="prefetch" href="/W2021/assets/js/16.34877f8a.js"><link rel="prefetch" href="/W2021/assets/js/17.42df5c8b.js"><link rel="prefetch" href="/W2021/assets/js/18.d6c2d19c.js"><link rel="prefetch" href="/W2021/assets/js/19.8f274ad4.js"><link rel="prefetch" href="/W2021/assets/js/20.ee15ddf1.js"><link rel="prefetch" href="/W2021/assets/js/21.040787d3.js"><link rel="prefetch" href="/W2021/assets/js/22.c1c08c07.js"><link rel="prefetch" href="/W2021/assets/js/23.24360df1.js"><link rel="prefetch" href="/W2021/assets/js/24.15b158c0.js"><link rel="prefetch" href="/W2021/assets/js/25.f6afa99c.js"><link rel="prefetch" href="/W2021/assets/js/26.e108e2ea.js"><link rel="prefetch" href="/W2021/assets/js/27.901ee059.js"><link rel="prefetch" href="/W2021/assets/js/28.aa362c99.js"><link rel="prefetch" href="/W2021/assets/js/29.03adf946.js"><link rel="prefetch" href="/W2021/assets/js/3.54197ee6.js"><link rel="prefetch" href="/W2021/assets/js/30.3b5bf566.js"><link rel="prefetch" href="/W2021/assets/js/31.e8f8cd55.js"><link rel="prefetch" href="/W2021/assets/js/32.3881a5bc.js"><link rel="prefetch" href="/W2021/assets/js/33.aec743e8.js"><link rel="prefetch" href="/W2021/assets/js/34.989038db.js"><link rel="prefetch" href="/W2021/assets/js/35.0103cacb.js"><link rel="prefetch" href="/W2021/assets/js/36.5cb7f62a.js"><link rel="prefetch" href="/W2021/assets/js/37.23dca0df.js"><link rel="prefetch" href="/W2021/assets/js/38.8d291227.js"><link rel="prefetch" href="/W2021/assets/js/39.7e01411f.js"><link rel="prefetch" href="/W2021/assets/js/4.bb14ba1f.js"><link rel="prefetch" href="/W2021/assets/js/40.a50e72d6.js"><link rel="prefetch" href="/W2021/assets/js/41.87e553d4.js"><link rel="prefetch" href="/W2021/assets/js/42.d17778b7.js"><link rel="prefetch" href="/W2021/assets/js/43.9ee0e615.js"><link rel="prefetch" href="/W2021/assets/js/44.a0384434.js"><link rel="prefetch" href="/W2021/assets/js/45.e12cab43.js"><link rel="prefetch" href="/W2021/assets/js/46.ff49787c.js"><link rel="prefetch" href="/W2021/assets/js/47.931a5164.js"><link rel="prefetch" href="/W2021/assets/js/48.93a1f250.js"><link rel="prefetch" href="/W2021/assets/js/49.ed2942b4.js"><link rel="prefetch" href="/W2021/assets/js/5.a7665843.js"><link rel="prefetch" href="/W2021/assets/js/50.36e0d8ca.js"><link rel="prefetch" href="/W2021/assets/js/51.d12854eb.js"><link rel="prefetch" href="/W2021/assets/js/52.698198e0.js"><link rel="prefetch" href="/W2021/assets/js/53.1b1c9b0c.js"><link rel="prefetch" href="/W2021/assets/js/54.1dbf137a.js"><link rel="prefetch" href="/W2021/assets/js/55.69963126.js"><link rel="prefetch" href="/W2021/assets/js/56.a3a2e578.js"><link rel="prefetch" href="/W2021/assets/js/57.cc80d260.js"><link rel="prefetch" href="/W2021/assets/js/58.efd50c39.js"><link rel="prefetch" href="/W2021/assets/js/59.0a02def4.js"><link rel="prefetch" href="/W2021/assets/js/6.a6f59c61.js"><link rel="prefetch" href="/W2021/assets/js/60.75b38a09.js"><link rel="prefetch" href="/W2021/assets/js/61.c225e561.js"><link rel="prefetch" href="/W2021/assets/js/62.d734d751.js"><link rel="prefetch" href="/W2021/assets/js/63.732d87a3.js"><link rel="prefetch" href="/W2021/assets/js/65.4086fe0e.js"><link rel="prefetch" href="/W2021/assets/js/7.30cb0167.js"><link rel="prefetch" href="/W2021/assets/js/8.0d49ee3f.js">
    <link rel="stylesheet" href="/W2021/assets/css/0.styles.9c5fa8ba.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/W2021/" class="home-link router-link-active"><!----> <span class="site-name">MAD9022-W21</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/W2021/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/W2021/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/W2021/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/W2021/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/W2021/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/W2021/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Content Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/W2021/modules/week1/" class="sidebar-link">Week 1 - Cordova, CSP, NPM</a></li><li><a href="/W2021/modules/week2/" class="sidebar-link">Week 2 - Cordova Android, Classes, ENV</a></li><li><a href="/W2021/modules/week3/" class="sidebar-link">Week 3 - Destructuring, Async, Cordova Camera</a></li><li><a href="/W2021/modules/week4/" class="sidebar-link">Week 4 - Cordova File, SplashScreen, Icons</a></li><li><a href="/W2021/modules/week5/" class="sidebar-link">Week 5 - Iterators, Generators, Maps, Sets, iPhone-X</a></li><li><a href="/W2021/modules/week6/" class="sidebar-link">Week 6 - Cordova Media, CORS</a></li><li><a href="/W2021/modules/week7/" class="sidebar-link">Week 7 - Cordova</a></li><li><a href="/W2021/modules/week8/" class="sidebar-link">Week 8 - Web Workers &amp; Copying Objects</a></li><li><a href="/W2021/modules/week9/" aria-current="page" class="sidebar-link">Week 9 - IndexedDB &amp; Service Workers</a></li><li><a href="/W2021/modules/week10/" class="sidebar-link">Week 10 - PWA Core</a></li><li><a href="/W2021/modules/week11/" class="sidebar-link">Week 11 - PWA Continued</a></li><li><a href="/W2021/modules/week12/" class="sidebar-link">Week 12 - Caching and Custom Protocols</a></li><li><a href="/W2021/modules/week13/" class="sidebar-link">Week 13 - CORS in Detail</a></li><li><a href="/W2021/modules/week14/" class="sidebar-link">Week 14 - Final Project</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deliverables</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="indexed-db-api"><a href="#indexed-db-api" class="header-anchor">#</a> Indexed DB API</h1> <p>The <code>IndexedDB API</code> gives us the ability to create local document databases that are accessible with JavaScript through either a script that is attached to an HTML file or through a Service Worker.</p> <h2 id="indexeddb-libraries"><a href="#indexeddb-libraries" class="header-anchor">#</a> IndexedDB Libraries</h2> <p>There are a number of libraries that have been created to allow us to manage and use IndexedDB databases. Too many to cover here in fact.</p> <p>However, if you only want to use your IndexedDB database like you have used LocalStorage or SessionStorage then a good choice is <a href="https://github.com/jakearchibald/idb-keyval" target="_blank" rel="noopener noreferrer">Jake Archibald's idb-key library<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>It gives us a small number of methods and works with Promises so we can chain methods with <code>then()</code> methods. It treats all the stores like key-value pairs like LocalStorage does.</p> <p>Watch this video for a complete overview.</p> <div title="Idb-keyval library" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/6fK1K28eoUA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <p>Here are some of the main methods for <code>idb-keyval</code>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'mykey'</span><span class="token punctuation">,</span> <span class="token string">'my value'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'mykey'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'The value for mykey is'</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">'key1'</span><span class="token punctuation">,</span> <span class="token string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">getMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'key1'</span><span class="token punctuation">,</span> <span class="token string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">values</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//values is an array of values for those keys</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">delete</span> <span class="token string">'key1'</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success deleting'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="vanilla-js-and-the-indexeddb-api"><a href="#vanilla-js-and-the-indexeddb-api" class="header-anchor">#</a> Vanilla JS and the IndexedDB API</h2> <p>Once we move beyond simple key value pairs then it's better to switch libraries or write our own scripts with the built-in <code>IndexedDB API</code>.</p> <p>Here is the first of the 8 videos in the playlist about IndexedDB.</p> <div title="IndexedDB API Part 1" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/gb5ovg7YCig" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <p><a href="https://www.youtube.com/watch?v=gb5ovg7YCig&amp;list=PLyuRouwmQCjmNyAysdqjNz5fIS5cYU4vi&amp;index=2" target="_blank" rel="noopener noreferrer">Full IndexedDB Playlist<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="core-concepts"><a href="#core-concepts" class="header-anchor">#</a> Core Concepts</h2> <p>When writing your own code to work with IndexedDB, it is not any harder than using a library, it just means that you have to add your own functions for handling the success, complete, and error events.</p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API" target="_blank" rel="noopener noreferrer">MDN IndexedDB Reference section<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="structure"><a href="#structure" class="header-anchor">#</a> Structure</h3> <p>An IndexedDB is a document database. That means that the data tends to be in the form of <code>Object</code>s or <code>Arrays</code>. You can still store simple primitives like <code>String</code>s, <code>Number</code>s, and <code>Boolean</code>s. With IndexedDB you can <strong>also</strong> store Binary data like images or other files.</p> <p>The <code>database</code>s are bound to an origin (domain, protocol, and port).</p> <p>You are allowed to have multiple <code>database</code>s per origin.</p> <p>Inside a database you can have one or more <code>stores</code>.</p> <p>Each <code>store</code> is a collection of <code>Object</code>s.</p> <h3 id="opening-and-updating-databases-stores"><a href="#opening-and-updating-databases-stores" class="header-anchor">#</a> Opening and Updating Databases &amp; Stores</h3> <p>The methods used for communicating with the databases and stores have events that can be accessed through callback functions.</p> <p>To use a database you need to call the <code>indexedDB.open(name, ver)</code> method. It accepts a name <code>String</code> and a version <code>Number</code> as arguments. The method returns an <code>IDBOpenDBRequest</code> object. This object has three events - <code>success</code>, <code>error</code> and <code>upgradeneeded</code>.</p> <p>The <code>success</code> event fires when the database has successfully finished opening. This is when you would be able to save a global reference to the database in a global variable.</p> <p>The <code>error</code> event fires when there is ANY problem opening the database.</p> <p>The <code>upgradeneeded</code> event fires when you call the <code>indexedDB.open()</code> method with a different version number than what exists. This includes the first time you open the database. This is the ONLY place where you are allowed to create <code>stores</code>, delete <code>stores</code>, or create <code>indexes</code>. Basically, any time you want to change the structure of your database, this event handler function is the place to do it.</p> <h3 id="transactions-and-requests"><a href="#transactions-and-requests" class="header-anchor">#</a> Transactions and Requests</h3> <p>Any time you want to work with the data in your <code>stores</code> - Create, Read, Update, or Delete - you do this through a <code>Request</code>. Every <code>Request</code> or group of <code>Request</code>s <strong>must</strong> to be wrapped inside a <code>Transaction</code>.</p> <p>A <code>transaction</code> is create by calling the <code>db.transaction(store(s), mode)</code> method on your database object. It takes, as its first argument, either a store name <code>String</code> or an Array of store name <code>String</code>s. The second argument is the purpose of the transaction. It must be either <code>readonly</code> or <code>readwrite</code>.</p> <p>The <code>transaction</code> object returned from the <code>db.transaction()</code> method has two events - <code>error</code> and <code>complete</code>. The <code>error</code> event is pretty obvious. The <code>complete</code> event means that ALL the <code>request</code>s inside the <code>transaction</code> have completed successfully. This is usually a good place to put your code that moves on to the next step in your business logic.</p> <p>The <code>IDBRequest</code> objects inside every transaction have two events - <code>error</code> and <code>success</code>. Again, the <code>error</code> is pretty self explanatory. The <code>success</code> event handler function is where you would get access to the data that was retrieved through a read operation. For create, update, and delete operations you can use the <code>success</code> event to track your progress through the transaction and to inform the user.</p> <div title="IDB transactions and requests - part 2" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/PqqkL_Lg41k" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <h3 id="crud-methods"><a href="#crud-methods" class="header-anchor">#</a> CRUD Methods</h3> <p>CRUD is a common acronym used with databases. It refers to the four main actions that you can do with any database - Create, Read, Update, and Delete. In Relational Databases, you would use the <code>SQL</code> Structured Query Language, and call the commands <code>insert</code>, <code>select</code>, <code>update</code> and <code>delete</code>.</p> <p>With IndexedDB we have the following commands.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//CREATE</span>
store<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//insert an object. Fail if the key exists</span>
<span class="token comment">//READ</span>
store<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//get the first object where the key matches</span>
store<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span>key <span class="token operator">|</span> keyrange<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//get all the objects that match</span>
<span class="token comment">//UPDATE</span>
store<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//update. Overwrite if key exists. Insert if not.</span>
<span class="token comment">//DELETE</span>
store<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key <span class="token operator">|</span> keyrange<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//delete an object(s)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Notice how each of these commands has a variable <code>store</code> in front?</p> <p>Each time you want to run one of these commands you need to create a transaction, then get a reference to a specific <code>store</code> and then you can call the specific CRUD method.</p> <p>Every one of those methods will return a <code>IDBRequest</code> object that represents the request to carry out the CRUD operation.</p> <p>Here is a more complete example:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> tx <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'myStore'</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> store <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'myStore'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> req <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'someKey'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//ev.target is the same as req</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token comment">//result is the object we requested from the store.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//an error happened to the request.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>The example above shows both ways you can write the event listener functions. <code>onerror</code> and <code>onsuccess</code> or <code>addEventListener('success', func)</code> and <code>addEventListener('err', func)</code>. You can use either.</p> <p>If the <code>error</code> event fires, it will trigger the <code>transaction</code> <code>error</code> event.</p> <p>If the <code>success</code> event fires, it will trigger the <code>transaction</code> <code>complete</code> event.</p> <p>If you call the <code>get</code> method, then the <code>ev.target.result</code> value will be the single object that had the matching key.</p> <p>If you call the <code>getAll</code> method, then the <code>ev.target.result</code> object will be an <code>Array</code>, regardless of the number of records returned.</p> <p>If there are no matching keys for <code>get</code> or <code>getAll</code> the <code>success</code> event still fires. This is not an error. This is an empty result set.</p> <div title="IDB get, getAll - part 3" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/y--Rjq6QV_o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <div title="IDB Add, put, delete - part 4" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/8UFOSQXT_pg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <h3 id="keyranges"><a href="#keyranges" class="header-anchor">#</a> KeyRanges</h3> <p>When you want to bring back one or more records that match a range of keys then you can define an <code>IDBKeyRange</code> object to explain the possible range of values to match against.</p> <p>Keys in a <code>store</code> can be a <code>Number</code>, an <code>Array</code>, or a <code>String</code>. When you pass the value of a key to the <code>get</code> method it <strong>MUST</strong> be an exact match for the value and datatype. Think JavaScript <code>===</code>.</p> <p>To create a key we can call one of the following methods.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>IDBKeyRange<span class="token punctuation">.</span><span class="token function">lowerBound</span><span class="token punctuation">(</span>keyval<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
IDBKeyRange<span class="token punctuation">.</span><span class="token function">upperBound</span><span class="token punctuation">(</span>keyval<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span>lowerKeyval<span class="token punctuation">,</span> upperKeyval<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
IDBKeyRange<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>keyval<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//same as using a single key</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The <code>upperBound</code> and <code>lowerBound</code> methods let you provide either a max or a min value for the keys to match.</p> <p>The <code>bound</code> method lets you provide a min and max value for matching keys.</p> <p>The true and false values represent whether or not you want to omit the value(s) provided in the keyval arguments. <code>false</code> means that you want to include the value.</p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBKeyRange" target="_blank" rel="noopener noreferrer">KeyRange reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="indexes"><a href="#indexes" class="header-anchor">#</a> Indexes</h3> <p>An <code>index</code> can be created whenever you update a database's structure.</p> <p>Think of it as an extra column that is created with a sorted version of one of the properties. When you want to apply a <code>IDBKeyRange</code> for a <code>getAll</code> or <code>update</code> or <code>delete</code> you need to have things sorted based on the property you are comparing to the key range.</p> <p>You <strong>can</strong> create an index for every property but that is wasteful. Only create indexes for the properties that you will use for a <code>getAll</code> or <code>update</code> or <code>delete</code>.</p> <p>To create an index we use this method inside our <code>upgradeneeded</code> event handler function:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">'priceIDX'</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> unique<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The first argument is the label we are giving our new index column.</p> <p>The second argument is the property that will/does exist in our data.</p> <p>The third argument is our options object. We need to specify if the values of our property are required to be unique or not. In this case we are saying that the values in the price property are allowed to be duplicates.</p> <p>Once you have an index, then you can use it in place of a store object for creating the <code>IDBRequest</code>s in your transaction. Here is an example that creates a <code>transaction</code> and then makes a request for all the objects from our <code>store</code> that match a price between $50 and $100, inclusive. The example uses a <code>IDBKeyRange</code> as well as the index created above.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> tx <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'myStore'</span><span class="token punctuation">,</span> <span class="token string">'readonly'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> store <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'myStore'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> idx <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">'priceIDX'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> range <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> req <span class="token operator">=</span> idx<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  result<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//console each of the objects that matched.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div title="IDB Creating Indexes - part 6" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/sEzzowrLpYs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <div title="IDB Using Indexes - part 7" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/b-7qcQvgv_U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <h3 id="cursors"><a href="#cursors" class="header-anchor">#</a> Cursors</h3> <p>A cursor provides another way that we would move through the resulting recordset from a data request. It lets us provide a direction to move through the results - <code>next</code>, <code>nextunique</code>, <code>prev</code>, or <code>prevunique</code>.</p> <p>It uses an <code>openCursor(key|range, direction)</code> method to create the cursor. The cursor has a <code>success</code> and an <code>error</code> event. Each time the <code>success</code> event fires it means that the next record is available. You will always get one record at a time. The <code>success</code> event will fire one last time to say that the records have all be traversed.</p> <p>The <code>openCursor(key|range, direction)</code> method can be called on either a <code>store</code> or an <code>index</code> object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>idx<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span>range<span class="token punctuation">,</span> <span class="token string">'next'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> cursor <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//call success again</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">//end of record set</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div title="IDB Cursors - part 8" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/OoYWkTQjJdc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <p><a href="/W2021/modules/week9/" class="router-link-active">Return to week home page</a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/3/2021, 5:20:47 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/W2021/assets/js/app.5f620c32.js" defer></script><script src="/W2021/assets/js/2.58046445.js" defer></script><script src="/W2021/assets/js/64.95e1f72f.js" defer></script><script src="/W2021/assets/js/9.536c9148.js" defer></script>
  </body>
</html>
